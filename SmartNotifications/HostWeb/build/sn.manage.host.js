var SN;!function(t){var e=SP.SOD,n=function(){function t(t,n,o){var i=this;this.key=t,this.src=n,this.onLoad=o,this.onLoadFunction=function(){"function"==typeof e.notifyScriptLoadedAndExecuteWaitingJobs&&e.notifyScriptLoadedAndExecuteWaitingJobs(i.key),i.onLoad&&"function"==typeof i.onLoad&&i.onLoad()},this.load=function(t){void 0===t&&(t=!1),e.loadMultiple([i.key],i.onLoadFunction,t)},this.registerDependency=function(t){t.forEach(function(t){e.registerSodDep(i.key,t.key)})},this.registerDependencyByName=function(t){t.forEach(function(t){e.registerSodDep(i.key,t)})},e.registerSod(this.key,this.src)}return t}();t.SPAsyncScript=n}(SN||(SN={}));var SN;!function(t){var e=function(){function t(){var t=this;this.hasPermissions=ko.observable(!1),this.loaded=ko.observable(!1),this.snEnabled=ko.observable(!1),this.customActionKey="sn.app";var e=SP.ClientContext.get_current();e.load(e.get_web(),"EffectiveBasePermissions");var n=e.get_web().get_userCustomActions();e.load(n),e.executeQueryAsync(function(){for(var o=n.getEnumerator(),i=!1;o.moveNext();){var s=o.get_current();s.get_name()===t.customActionKey&&(i=!0)}t.snEnabled(i),t.loaded(!0),t.hasPermissions(e.get_web().get_effectiveBasePermissions().has(SP.PermissionKind.manageWeb))},function(t,e){alert(e.get_message())})}return t.prototype.toggleState=function(){return this.snEnabled()?this.addScriptLink():this.removeScriptLink(),!0},t.prototype.removeScriptLink=function(){var t=this,e=SP.ClientContext.get_current(),n=e.get_web().get_userCustomActions();e.load(n),e.executeQueryAsync(function(){for(var o=n.getEnumerator(),i=null;o.moveNext();){var s=o.get_current();if(s.get_name()===t.customActionKey){i=s;break}}null!=i&&i.deleteObject(),e.executeQueryAsync(function(){var t=SP.UI.Notify.addNotification("Smart Notifications are switched OFF",!0);setTimeout(function(){SP.UI.Notify.removeNotification(t)},2e3)},function(t,e){alert(e.get_message())})},function(t,e){alert(e.get_message())})},t.prototype.addScriptLink=function(){var t=SP.ClientContext.get_current(),e=t.get_web().get_userCustomActions().add();e.set_location("ScriptLink"),e.set_scriptSrc("~Site/SmartNotificationsAssets/sn.scriptlink.js"),e.set_sequence(9),e.set_title("Smart Notifications"),e.set_description("Smart Notifications App"),e.set_name(this.customActionKey),e.update(),t.executeQueryAsync(function(){var t=SP.UI.Notify.addNotification("Smart Notifications are switched ON",!0);setTimeout(function(){SP.UI.Notify.removeNotification(t)},2e3)},function(t,e){alert(e.get_message())})},t}();t.ManageAppViewModel=e}(SN||(SN={}));var SN;!function(t){!function(e){SP.SOD.executeOrDelayUntilScriptLoaded(function(){function n(){Type.registerNamespace("ko"),jQuery.get("./templates.html").then(function(e){jQuery("body").append('<div style="display:none">'+e+"</div>"),ko.applyBindings(new t.ManageAppViewModel,document.getElementById("sn-manage-app"))})}function o(){if(e.ko)n();else{var o=new t.SPAsyncScript("snknockout","./knockout.js",n);o.load()}}function i(){_spBodyOnLoadCalled?r():_spBodyOnLoadFunctions.push(r)}function s(){var t=_spPageContextInfo.webServerRelativeUrl;t=t.endsWith("/")?t:t+"/",RegisterModuleInit(t+"SmartNotificationsAssets/sn.manage.host.js",function(){e.registerCssLink(_spPageContextInfo.webAbsoluteUrl+"/SmartNotificationsAssets/bootstrap.css"),e.registerCssLink(_spPageContextInfo.webAbsoluteUrl+"/SmartNotificationsAssets/styles.css"),i()})}var r=function(){SP.SOD.executeOrDelayUntilScriptLoaded(function(){if(e.jQuery)o();else{e.registerCssLink(_spPageContextInfo.webAbsoluteUrl+"/SmartNotificationsAssets/bootstrap.css"),e.registerCssLink(_spPageContextInfo.webAbsoluteUrl+"/SmartNotificationsAssets/styles.css");var n=new t.SPAsyncScript("snjquery","./jquery.js",o);n.load()}},"sp.js")};i(),"function"==typeof RegisterModuleInit&&(_spBodyOnLoadCalled?s():_spBodyOnLoadFunctions.push(s))},"sp.js")}(window)}(SN||(SN={}));