var SNScriptLink;!function(t){var e=SP.SOD,n=function(){function t(t,n,i){var o=this;this.key=t,this.src=n,this.onLoad=i,this.onLoadFunction=function(){"function"==typeof e.notifyScriptLoadedAndExecuteWaitingJobs&&e.notifyScriptLoadedAndExecuteWaitingJobs(o.key),o.onLoad&&"function"==typeof o.onLoad&&o.onLoad()},this.load=function(t){void 0===t&&(t=!1),e.loadMultiple([o.key],o.onLoadFunction,t)},this.registerDependency=function(t){t.forEach(function(t){e.registerSodDep(o.key,t.key)})},this.registerDependencyByName=function(t){t.forEach(function(t){e.registerSodDep(o.key,t)})},e.registerSod(this.key,this.src)}return t}();t.SPAsyncScript=n}(SNScriptLink||(SNScriptLink={}));var SNScriptLink;!function(t){var e=function(){function t(){}return t.save=function(t,e){localStorage.setItem(t,JSON.stringify(e))},t.load=function(t){var e=localStorage.getItem(t);return e?JSON.parse(e):null},t}();t.Storage=e}(SNScriptLink||(SNScriptLink={}));var SNScriptLink;!function(t){var e=function(){function t(){}return t.StorageKey="sn_dismissed_items",t.WebRelUrl="SmartNotifications",t.NotificationsListTitle="Notifications",t.AppSettingsListTitle="AppSettings",t.SettingsKey="appsettings",t.AppSettingsCaml="\n			<Where>\n				<Eq>\n					<FieldRef Name='Key_SN' /> \n					<Value Type='Text'>appsettings</Value> \n				</Eq>\n			</Where>",t.CamlString="\n			<Where>\n				<And>\n					<Or>\n						<Or>\n							<Or>\n								<And>\n									<Leq> \n										<FieldRef Name='From_SN' /> \n										<Value IncludeTimeValue='TRUE' Type='DateTime'><Today /></Value> \n									</Leq> \n									<Geq> \n										<FieldRef Name='To_SN' /> \n										<Value IncludeTimeValue='TRUE' Type='DateTime'><Today /></Value> \n									</Geq> \n								</And>\n								<And>\n									<Leq> \n										<FieldRef Name='From_SN' /> \n										<Value IncludeTimeValue='TRUE' Type='DateTime'><Today /></Value> \n									</Leq> \n									<IsNull> \n										<FieldRef Name='To_SN' />\n									</IsNull> \n								</And>\n							</Or>\n							<And>\n								<IsNull> \n									<FieldRef Name='From_SN' />\n								</IsNull> \n								<Geq> \n									<FieldRef Name='To_SN' /> \n									<Value IncludeTimeValue='TRUE' Type='DateTime'><Today /></Value> \n								</Geq> \n							</And>\n						</Or>\n						<And>\n							<IsNull> \n								<FieldRef Name='From_SN' />\n							</IsNull> \n							<IsNull> \n								<FieldRef Name='To_SN' />\n							</IsNull> \n						</And>\n					</Or>\n					<Or>\n						<Membership Type='CurrentUserGroups'>\n							<FieldRef Name='AssignedTo_SN'/>\n						</Membership>\n						<Includes>\n							<FieldRef Name='AssignedTo_SN'/>\n							<Value Type='Integer'><UserID /></Value>\n						</Includes>\n					</Or>\n				</And>\n			</Where>",t}();t.Consts=e}(SNScriptLink||(SNScriptLink={}));var SNScriptLink;!function(t){var e=function(){function e(){var e=this;this.grouppedNotifications=ko.observableArray([]),this.getAppSettings().then(function(n){var i=JSON.parse(LZString.decompressFromBase64(n.get_item("Value_SN")));if(!i.invalidLicense){if(i.trial){var o=new Date,r=new Date(i.installationDate),s=Math.abs(o.getTime()-r.getTime()),a=Math.ceil(s/864e5);if(a>30)return}e.getNotifications().then(function(n){var i=SP.ClientContext.get_current(),o=i.get_site().openWeb(e.getSubWebUrl()+t.Consts.WebRelUrl);i.load(o,"Id"),i.executeQueryAsync(function(){var i=o.get_id().toString(),r=t.Storage.load(t.Consts.StorageKey);null==r&&(r={},r[i]=[]);for(var s=r[i],a=n.getEnumerator(),l=[];a.moveNext();){var c=a.get_current(),u=new t.Notification;u.color=c.get_item("Color_SN"),u.dismissable=c.get_item("Dismissable_SN"),u.title=c.get_item("Title"),u.text=c.get_item("Message_SN"),u.id=c.get_id(),s&&s.length>0&&-1!==s.indexOf(u.id.toString())||l.push(u)}for(var p=[],f=0;f<l.length;f++)-1===p.indexOf(l[f].color)&&p.push(l[f].color);for(var f=0;f<p.length;f++){var g=new t.NotificationItems;ko.utils.arrayPushAll(g.notifications,e.getNotificationsByColor(p[f],l)),g.notifications.valueHasMutated(),g.key=p[f],g.rgba=e.hexToRgb(p[f]),g.boxShadow=String.format("0 0 5px {0}",p[f]),e.grouppedNotifications().push(g)}e.grouppedNotifications.valueHasMutated()})})}})}return e.prototype.showNotifications=function(t){var e=jQuery("#sn-notify-modal").clone().appendTo("#sn-notify-modal");SP.UI.ModalDialog.showModalDialog({title:"Notifications",html:e[0],autoSize:!0}),e.show(),ko.applyBindings(t,e[0]);var n=SP.UI.ModalDialog.get_childDialog();n&&n.autoSize()},e.prototype.onError=function(t){console.log&&(console.log(t),console.log(t.get_message()))},e.prototype.getNotificationsByColor=function(t,e){return e.filter(function(e){return e.color===t})},e.prototype.hexToRgb=function(t){var e=parseInt(t.substring(1,t.length),16),n=e>>16&255,i=e>>8&255,o=255&e;return String.format("rgba({0},{1},{2},0.7)",n,i,o)},e.prototype.getAppSettings=function(){var e=this,n=jQuery.Deferred(),i=SP.ClientContext.get_current(),o=i.get_site().openWeb(this.getSubWebUrl()+t.Consts.WebRelUrl),r=o.get_lists().getByTitle(t.Consts.AppSettingsListTitle);return i.load(r),i.executeQueryAsync(function(){var o=new SP.CamlQuery;o.set_viewXml(String.format("<View><Query>{0}</View></Query>",t.Consts.AppSettingsCaml));var s=r.getItems(o);i.load(s),i.executeQueryAsync(function(){n.resolve(s.get_item(0))},function(t,n){e.onError(n)})},function(t,n){e.onError(n)}),n.promise()},e.prototype.getSubWebUrl=function(){var t=_spPageContextInfo.webServerRelativeUrl.replace(_spPageContextInfo.siteServerRelativeUrl,"");return""!==t&&(t+="/"),t=0===t.indexOf("/")?t.substring(1):t},e.prototype.getNotifications=function(){var e=this,n=jQuery.Deferred(),i=SP.ClientContext.get_current(),o=i.get_site().openWeb(this.getSubWebUrl()+t.Consts.WebRelUrl),r=o.get_lists().getByTitle(t.Consts.NotificationsListTitle);return i.load(r),i.executeQueryAsync(function(){var o=new SP.CamlQuery;o.set_viewXml(String.format("<View><Query>{0}</View></Query>",t.Consts.CamlString));var s=r.getItems(o);i.load(s),i.executeQueryAsync(function(){n.resolve(s)},function(t,n){e.onError(n)})},function(t,n){e.onError(n)}),n.promise()},e}();t.ScriptLinkViewModel=e}(SNScriptLink||(SNScriptLink={}));var SNScriptLink;!function(t){var e=function(){function e(){this.isHovering=ko.observable(!1),this.notifications=ko.observableArray([])}return e.prototype.onAfterRender=function(t){for(var e=0;e<t.notifications().length;e++)t.notifications()[e].active(!1);var n=t.notifications()[0];n.active(!0)},e.prototype.dismiss=function(t){var e=this.getActiveNotification(),n=this.notifications.indexOf(e);this.notifications().length>1?this.go("next"):SP.UI.ModalDialog.get_childDialog().close(SP.UI.DialogResult.OK),this.notifications.splice(n,1),this.notifications.valueHasMutated(),this.updateDissmissedItems(e)},e.prototype.go=function(t){var e=this.getActiveNotification();"prev"===t?this.goPrev(e):this.goNext(e),SP.UI.ModalDialog.get_childDialog().autoSize()},e.prototype.getSubWebUrl=function(){var t=_spPageContextInfo.webServerRelativeUrl.replace(_spPageContextInfo.siteServerRelativeUrl,"");return""!==t&&(t+="/"),t=0===t.indexOf("/")?t.substring(1):t},e.prototype.updateDissmissedItems=function(e){var n=SP.ClientContext.get_current(),i=n.get_site().openWeb(this.getSubWebUrl()+t.Consts.WebRelUrl);n.load(i,"Id"),n.executeQueryAsync(function(){var n=i.get_id().toString(),o=t.Storage.load(t.Consts.StorageKey);null!=o&&o[n]?o[n].push(e.id.toString()):(o=o||{},o[n]=[e.id.toString()]),t.Storage.save(t.Consts.StorageKey,o)},function(t,e){console.log&&(console.log(e),console.log(e.get_message()))})},e.prototype.goNext=function(t){var e=this.notifications.indexOf(t),n=0;e!==this.notifications().length-1&&(n=e+1),t.active(!1);var i=this.notifications()[n];i.active(!0)},e.prototype.goPrev=function(t){var e=this.notifications.indexOf(t),n=this.notifications().length-1;0!==e&&(n=e-1),t.active(!1);var i=this.notifications()[n];i.active(!0)},e.prototype.getActiveNotification=function(){return this.notifications().filter(function(t){return t.active()})[0]},e}();t.NotificationItems=e}(SNScriptLink||(SNScriptLink={}));var SNScriptLink;!function(t){SP.SOD.executeOrDelayUntilScriptLoaded(function(){ko.bindingHandlers.hover={init:function(t,e){var n=e();ko.applyBindingsToNode(t,{event:{mouseenter:function(){n(!0)},mouseleave:function(){n(!1)}}})}}},"snknockout")}(SNScriptLink||(SNScriptLink={}));var SNScriptLink;!function(t){var e=function(){function t(){this.title="",this.active=ko.observable(!1)}return t}();t.Notification=e}(SNScriptLink||(SNScriptLink={}));var SNScriptLink;!function(t){!function(e){function n(){jQuery.get(_spPageContextInfo.webAbsoluteUrl+"/SmartNotificationsAssets/templates.html").then(function(e){Type.registerNamespace("ko"),Type.registerNamespace("LZString"),jQuery("body").append('<div style="display:none">'+e+"</div>"),jQuery("#RibbonContainer-TabRowRight").prepend('<div class="sn-app-bootstrap" id="sn-app-scriptlink" data-bind="template: {name: \'sn-app-scriptlink-tmpl\'}"></div>'),ko.applyBindings(new t.ScriptLinkViewModel,document.getElementById("sn-app-scriptlink"))})}function i(){if(e.LZString)n();else{var i=new t.SPAsyncScript("snlzstring",_spPageContextInfo.webAbsoluteUrl+"/SmartNotificationsAssets/lz-string.min.js",n);i.load()}}function o(){if(e.ko)i();else{var n=new t.SPAsyncScript("snknockout",_spPageContextInfo.webAbsoluteUrl+"/SmartNotificationsAssets/knockout.js",i);n.load()}}function r(){_spBodyOnLoadCalled?a():_spBodyOnLoadFunctions.push(a)}function s(){var t=_spPageContextInfo.webServerRelativeUrl;t=t.endsWith("/")?t:t+"/",RegisterModuleInit(t+"SmartNotificationsAssets/sn.scriptlink.js",function(){e.registerCssLink(_spPageContextInfo.webAbsoluteUrl+"/SmartNotificationsAssets/styles.css"),r()})}var a=function(){SP.SOD.executeOrDelayUntilScriptLoaded(function(){if(e.jQuery)o();else{e.registerCssLink(_spPageContextInfo.webAbsoluteUrl+"/SmartNotificationsAssets/styles.css");var n=new t.SPAsyncScript("snjquery",_spPageContextInfo.webAbsoluteUrl+"/SmartNotificationsAssets/jquery.js",o);n.load()}},"sp.js"),SP.SOD.loadMultiple(["sp.js"],function(){})};r(),"function"==typeof RegisterModuleInit&&(_spBodyOnLoadCalled?s():_spBodyOnLoadFunctions.push(s))}(window)}(SNScriptLink||(SNScriptLink={}));